<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Batch edit with ed">
    <meta name="author" content="Konstantin Nazarov">
    <meta property="article:published_time" content="DATE"/>

    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="me" href="https://mas.to/@amadv" />
    <meta name="fediverse:creator" content="@amadv@mas.to" />
    <title>Batch edit with ed</title>
    <link rel="alternate" type="application/rss+xml"
        title="RSS Feed for amadv.github.io" href="/rss.xml" />
  </head>
  <body>
    <header class="header">
      <a href="/">∴ Aaron Madved</a>
    </header>
    <nav class="menu">
        <a href="/posts">posts</a>
        <a href="https://github.com/amadv">github</a>
        <!-- <a href="/projects">projects</a> -->
        <!-- <a href="/cv">cv</a> -->
        <a href="/uses">uses</a>
        <a href="/contact">contact</a>
        <a href="/rss.xml"><img src="/rss.png" style="height: 15px; width: auto; vertical-align:middle;"></img></a>
    </nav>
    <main>
      <h1>Batch edit with ed</h1>
<p>The other day at work I needed to edit 200 files at once across dozens of repos. I wanted to do something pretty simple: basically, I had files that looked like this:</p>
<pre><code>foo:
  - bar
  - baz
  - bananas
</code></pre>
<p>and I wanted to insert an extra line after the <code>baz</code> line that said <code>elephant</code></p>
<pre><code>foo:
  - bar
  - baz
  - elephant
  - bananas
</code></pre>
<p>I had one extra weird requirement which was that some of the lines were indented with 2 spaces, and some with 4 spaces. The <code>- elephant</code> line needed to have the same indentation as the previous line.</p>
<p>I didn’t feel like writing a program to do this (perl would be perfect, but I don’t really remember perl at all), so I wanted to use a command line tool! A vim macro could do it, but how do you save a vim macro to a file again? I forget! I couldn’t think of how to do it with sed at the time, though in retrospect you could do something like <code>s/(.+)- baz/\1- baz\n\1- elephant</code>.</p>
<p>In a surprising turn of events, I ended up using the <code>ed</code> editor to do this task, and it was really easy and simple to do! In this blog post I’ll make the case that if you have something you might normally accomplish with a Vim macro, you might conceivably want to use Ed for it!</p>
<h3><a href="#what-s-ed">what’s ’ed'?</a></h3>
<p><code>ed</code> is this sort of terrifying text editor. A typical interaction with <code>ed</code> for me in the past has gone something like this:</p>
<pre><code>$ ed
help
?
h
?
asdfasdfasdfsadf
?
&lt;close terminal in frustration&gt;
</code></pre>
<p>Basically if you do something wrong, ed will just print out a single, unhelpful, <code>?</code>. So I’d basically dismissed <code>ed</code> as an old arcane Unix tool that had no practical use today.</p>
<p><code>vi</code> is a successor to <code>ed</code>, except with a visual interface instead of this <code>?</code></p>
<h3><a href="#surprise-ed-is-actually-sort-of-cool-and-fun">surprise: Ed is actually sort of cool and fun</a></h3>
<p>So if Ed is a terrifying thing that only prints <code>?</code> at you, why am I writing a blog post about it? WELL!!!!</p>
<p>On April 1 this year, Michael W Lucas published a new short book called <a href="https://www.michaelwlucas.com/tools/ed">Ed Mastery</a>. I like his writing, and even though it was sort of an april fool’s joke, it was ALSO a legitimate actual real book, and so I bought it and read it to see if his claims that Ed is actually interesting were true.</p>
<p>And it was so cool!!!! I found out:</p>
<ul>
<li>how to get Ed to give you better error messages than just <code>?</code></li>
<li>that the name of the <code>grep</code> command comes from ed syntax (<code>g/re/p</code>)</li>
<li>the basics of how to navigate and edit files using ed</li>
</ul>
<p>All of that was a cool Unix history lesson, but did not make me want to actually use Ed in real life. But!!!</p>
<p>The other neat thing about Ed (that did make me want to use it!) is that any Ed session corresponds to a script that you can replay! So if I know Ed, then I can use Ed basically as a way to easily apply vim-macro-like programs to my files.</p>
<h3><a href="#how-i-solved-my-problem-with-ed">how I solved my problem with ed</a></h3>
<p>So! we have a file like this:</p>
<pre><code>foo:
  - bar
  - baz
  - bananas
</code></pre>
<p>and we want to add a line after <code>- baz</code> that says <code>- elephant</code>. Let’s do it!!</p>
<p>With Vim, I’d do it by:</p>
<ol>
<li>search for <code>baz</code></li>
<li>copy that line and paste it</li>
<li><code>s/baz/elephant</code></li>
<li>save &amp; quit</li>
</ol>
<p>We can translate that into an Ed script in a really pretty straightforward way!!</p>
<pre><code>/baz                 # search for `baz`
.t.                  # copy that line and paste it on the next line
s/baz/elephants      # on the second, pasted, line replace `baz` with `elephants`
w                    # save
q                    # quit
</code></pre>
<p>ed doesn’t actually have comments, so if you wanted to actually run this ed script you’ll have to remove the <code>#</code> things</p>
<p>Most of this is very similar to what you’d do in Vim – the <code>.t.</code> part of this is the most inscrutable bit, but I figured it out through some judicious use of Stack Overflow.</p>
<h3><a href="#using-the-ed-script">using the ed script</a></h3>
<p>Applying the ed script to the file I want to edit is easy! Here’s how;</p>
<pre><code>cat my-script.ed | ed file-to-edit.txt
</code></pre>
<p>(or you could write <code>ed file-to-edit.txt &lt; my-script.ed</code>, but I always use cat and pipe in practice :) )</p>
<h3><a href="#ed-is-at-least-a-little-bit-useful">Ed is at least a little bit useful!!!!</a></h3>
<p>It was super surprising and delightful to me to find a practical use for Ed! To me the most compelling thing about Ed is that I use simple Vim macros a lot, and it’s a pretty direct way to translate a Vim macro into a way to batch edit a bunch of files.</p>
<p>I’m definitely not going to go telling everyone they should be using ed (it’s certainly not very user friendly!), but I think it’s neat. If you’re interested, I’d really recommend buying <a href="https://www.michaelwlucas.com/tools/ed">Ed Mastery</a> – it’s quite short, I learned some neat Unix history from it, and now I have a new tool to use very occasionally!!</p>
    </main>
    <footer>
    <a href="/feedback">Ask me questions about this page or give feedback</a>
    </footer>
  </body>
</html>